# –≠—Ç–∞–ø 1: –î–µ—Ç–∞–ª—å–Ω–æ–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ - –ë–∞—Ç—á–µ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

## üìã –û–±–∑–æ—Ä

–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –±–∞—Ç—á–µ–≤—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –±–æ–ª—å—à–∏—Ö JSONL —Ñ–∞–π–ª–æ–≤ —Å –ø–æ–º–æ—â—å—é Apache Spark, –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –∫–∞—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ Parquet —Ñ–æ—Ä–º–∞—Ç–µ –≤ MinIO.

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ JSONL —Ñ–∞–π–ª—ã ‚îÇ
‚îÇ  16GB+ each ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Spark Batch    ‚îÇ
‚îÇ      Job        ‚îÇ
‚îÇ                 ‚îÇ
‚îÇ  - Read         ‚îÇ
‚îÇ  - Parse        ‚îÇ
‚îÇ  - Filter       ‚îÇ
‚îÇ  - Transform    ‚îÇ
‚îÇ  - Aggregate    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Storage       ‚îÇ
‚îÇ  (S3-compatible)‚îÇ
‚îÇ                 ‚îÇ
‚îÇ  Parquet files  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Spark Query    ‚îÇ
‚îÇ  (Percentiles)  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## 1Ô∏è‚É£ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

### 1.1 –î–æ–±–∞–≤–∏—Ç—å MinIO –≤ docker-compose.yml

–î–æ–±–∞–≤—å—Ç–µ MinIO (S3-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ) –≤ docker-compose.yml.

### 1.2 –î–æ–±–∞–≤–∏—Ç—å Spark –∫–ª–∞—Å—Ç–µ—Ä –≤ docker-compose.yml

–î–æ–±–∞–≤—å—Ç–µ Spark –∫–ª–∞—Å—Ç–µ—Ä –≤ docker-compose.yml.

---

## 2Ô∏è‚É£ –ù–∞–ø–∏—Å–∞–Ω–∏–µ Spark Batch Job

### 2.1 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

–û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ.

### 2.2 –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ batch_job.py

#### –ß—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

–†–µ–∞–ª–∏–∑—É–π—Ç–µ —á—Ç–µ–Ω–∏–µ JSONL —Ñ–∞–π–ª–æ–≤.

#### –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö

–ò–∑—É—á–∏—Ç–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –∫–∞–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∫–∞—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç. –†–µ–∞–ª–∏–∑—É–π—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É:

- –û–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –ø–∞—Ä—Å–∏–Ω–≥–∞
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—é –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—é
- –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é
- –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –∏ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏

#### Join —Å–æ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞–º–∏

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ `device_info.csv` –∏ `firmware_info.csv` –¥–ª—è –æ–±–æ–≥–∞—â–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö. –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–± join —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ.

#### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

–ò–∑—É—á–∏—Ç–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∫—É. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ repartition, AQE –∏–ª–∏ –¥—Ä—É–≥–∏–µ –º–µ—Ç–æ–¥—ã.

#### –ê–≥—Ä–µ–≥–∞—Ü–∏–∏ –∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è

–†–µ–∞–ª–∏–∑—É–π—Ç–µ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö. –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –∫–∞–∫–∏–µ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –Ω—É–∂–Ω—ã —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ.

#### –ó–∞–ø–∏—Å—å –≤ Parquet –≤ MinIO

–†–µ–∞–ª–∏–∑—É–π—Ç–µ –∑–∞–ø–∏—Å—å –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ Parquet —Ñ–æ—Ä–º–∞—Ç –≤ MinIO.

### 2.3 Dockerfile –∏ docker-compose.yml

–°–æ–∑–¥–∞–π—Ç–µ Dockerfile –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ docker-compose.yml –¥–ª—è –∑–∞–ø—É—Å–∫–∞ batch job.

---

## 3Ô∏è‚É£ Spark Query –¥–ª—è –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª–µ–π

### 3.1 –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∑–∞–ø—Ä–æ—Å—É

–ù–∞–ø–∏—Å–∞—Ç—å Spark SQL –∏–ª–∏ PySpark –∫–æ–¥ –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è:

**–ó–∞–ø—Ä–æ—Å:**
> –í—ã—á–∏—Å–ª–∏—Ç—å 95-–π –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª—å event_duration –ø–æ device_type –ø–æ –¥–Ω—è–º, –∏—Å–∫–ª—é—á–∏–≤ outliers, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã—Ö–æ–¥—è—Ç –∑–∞ –ø—Ä–µ–¥–µ–ª—ã 3 —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–π –æ—Ç –¥–Ω–µ–≤–Ω–æ–≥–æ —Å—Ä–µ–¥–Ω–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è. –í–∫–ª—é—á–∏—Ç—å —Ç–æ–ª—å–∫–æ —Ç–µ device_type, –∫–æ—Ç–æ—Ä—ã–µ –∏–º–µ–ª–∏ –º–∏–Ω–∏–º—É–º 500 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π –≤ –¥–µ–Ω—å.

### 3.2 –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

–†–µ–∞–ª–∏–∑—É–π—Ç–µ –∑–∞–ø—Ä–æ—Å —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ.

### 3.3 –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

–°–æ–∑–¥–∞–π—Ç–µ –≤–∞–ª–∏–¥–∞—Ü–∏—é —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∑–∞–ø—Ä–æ—Å–∞.

---

## 4Ô∏è‚É£ –ó–∞–ø—É—Å–∫ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞

–†–µ–∞–ª–∏–∑—É–π—Ç–µ –∑–∞–ø—É—Å–∫ –ø–∞–π–ø–ª–∞–π–Ω–∞ –∏ –ø—Ä–æ–≤–µ—Ä–∫—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ:
- –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- Batch job –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ MinIO
- Spark query –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∏ –¥–∞—ë—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

- [ ] MinIO –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω
- [ ] Spark –∫–ª–∞—Å—Ç–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
- [ ] Batch job —á–∏—Ç–∞–µ—Ç JSONL —Ñ–∞–π–ª—ã
- [ ] –î–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã (–æ–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—ã –∫–∞—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ)
- [ ] –û—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã –±–µ–∑ –ø–∞–¥–µ–Ω–∏—è job
- [ ] Join —Å–æ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞–º–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [ ] –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞
- [ ] –î–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∞–Ω—ã –≤ Parquet –≤ MinIO
- [ ] Parquet —Ñ–∞–π–ª—ã –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω—ã
- [ ] Spark query –≤—ã—á–∏—Å–ª—è–µ—Ç –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª–∏
- [ ] –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω—ã
- [ ] –ö–æ–¥ –∑–∞–∫–æ–º–º–∏—á–µ–Ω –∏ –∑–∞–ª–∏—Ç –≤ –≤–µ—Ç–∫—É

---

